# 20210824 회의록



## 오늘 한 일

- [Figma 목업](https://www.figma.com/file/Hj8XsYwKPGz1irqiiqNRdz/BOJ-BREAKER?node-id=0%3A1) 확인
- [ERD](https://dbdiagram.io/d/612115616dc2bb6073b52adb) 확인
  - User 테이블은 현재 구상 기능에선 필요없는 것으로 판단, 추가하지 않음
- RDS 사용 관련 논의
  - RDS를 사용하면 얻는 이점: 서버 부하 분산
  - RDS를 사용하면 잃는 것: 돈
  - 나중에 알림 서버를 따로 구매 계획 중이어서 로컬 DB로 가는 게 낫다는 판단
  - 후일 트래픽이 많이 발생하게 된다면 RDS로 전환 고려
- 크롤링 대상 논의
  - \*BOJ의 전체 문제 정보
  - BOJ의 전체 학교 정보 (일단 대학교만)
  - 학교 별로 AC 기록 (마지막 채점번호 직전까지)
  - 학교 별로 속한 유저 목록
  - 각 유저가 푼 문제 목록



## 예상되는 문제 및 해결방안

### 재채점이 발생하는 경우

- 에러 방지를 위해 주기적으로 `각 유저가 푼 문제 목록`을 새로 크롤링한다.
- 위에서 구한 목록을 모두 합쳐서(합집합) `학교가 푼 문제 목록`을 만든다.
  - 주기는 일주일에 한 번?
- CASE1: `AC → WA`
  - `Solved` 테이블에서 해당 학교가 푼 문제를 불러온다. (`solvedProblems`)
  - 새로 크롤링한 `학교가 푼 문제 목록`에 `solvedProblems`의 모든 문제들이 포함되어 있는지 확인한다.
    - 포함되어 있다면 pass
    - 포함되어 있지 않다면 `AC → WA`에 해당하는 케이스이므로 해당 row는 `Solved` 테이블에서 삭제해야한다. (`DELETE` 쿼리)
- CASE2: `WA → AC`
  - `Solved` 테이블에서 해당 학교가 푼 문제를 불러온다. (`solvedProblems`)
  - `solvedProblems`에 새로 크롤링한 `학교가 푼 문제 목록`의 모든 문제들이 포함되어 있는지 확인한다.
    - 포함되어 있다면 pass
    - 포함되어 있지 않다면 `WA → AC`에 해당하는 케이스이므로 해당 원소를 `Solved` 테이블에 새로 추가해준다.
- CASE1 + CASE2
  - 결국 새로 크롤링한 `학교가 푼 문제 목록`과 `solvedProblems`에 저장된 내용이 동기화되어야 한다.
    1. `Solved` 테이블에서 해당 학교가 푼 문제를 불러온다. (`solvedProblems`)
    2. 새로 크롤링한 `학교가 푼 문제 목록`에 `solvedProblems`의 모든 문제들이 포함되어 있는지 확인한다.
       - 포함되어 있다면 `학교가 푼 문제 목록`에서 해당 문제를 지워 나간다.
       - 포함되어 있지 않다면 `AC → WA`에 해당하는 케이스이므로 해당 row는 `Solved` 테이블에서 삭제해야한다. (`DELETE` 쿼리)
    3. `solvedProblems`를 모두 확인한 이후, 새로 크롤링한 `학교가 푼 문제 목록`에 아직 남아있는 원소가 있다면 이는 `WA → AC`에 해당하는 케이스이므로 해당 원소를 `Solved` 테이블에 새로 추가해준다.

### 그룹 내 유저 변동이 있는 경우

- 유저가 그룹에서 탈퇴하는 경우
  - `AC → WA`와 동일하게 처리
- 유저가 그룹에 새로 가입하는 경우
  - `WA → AC`와 동일하게 처리



## 다음에 할 일

- 크롤러 구현
  - 각 크롤링 스크립트를 함수화해서 나중에 하나의 클래스로 합치기
  - 시온
    - \*BOJ의 전체 문제 정보
    - BOJ의 전체 학교 정보 (일단 대학교만)
    - 각 유저가 푼 문제 목록
  - 문기
    - 학교 별로 AC 기록 (마지막 채점번호 직전까지)
    - 학교 별로 속한 유저 목록
- **다음 회의: 8/28 (토) 21시**
